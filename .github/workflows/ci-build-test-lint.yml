name: CI - Main Orchestrator

on:
  push:
    branches: [ main ]
    paths-ignore:
      - '**.md'
      - 'docs/**'
      - '.github/ISSUE_TEMPLATE/**'
      - '.github/CODEOWNERS'
      - '.github/labels.yml'
      - '.github/branch-protection.yml'
  pull_request:
    branches: [ main ]
    paths-ignore:
      - '**.md'
      - 'docs/**'
      - '.github/ISSUE_TEMPLATE/**'
      - '.github/CODEOWNERS'
      - '.github/labels.yml'
      - '.github/branch-protection.yml'
  workflow_dispatch:
    inputs:
      configuration:
        description: 'Build configuration (Debug or Release)'
        required: false
        default: 'Debug'
        type: choice
        options:
          - Debug
          - Release
      skip_tests:
        description: 'Skip test execution'
        required: false
        default: false
        type: boolean
      skip_lint:
        description: 'Skip code quality checks'
        required: false
        default: false
        type: boolean

# Concurrency control: cancel in-progress runs for same branch/PR
concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  # ============================================================================
  # This workflow orchestrates all CI jobs by documenting the workflow structure
  # Each job is now in its own file for better maintainability:
  # 
  # Validation & Quality:
  # - ci-code-quality.yml          - Code quality checks (SwiftLint)
  # - ci-validate-project.yml     - Project structure validation
  # - ci-validate-dependencies.yml - Dependency validation & caching
  # - ci-security-scan.yml         - Security scanning
  # 
  # Builds:
  # - ci-build-ios.yml             - iOS builds (Debug & Release)
  # - ci-build-macos.yml           - macOS builds (Debug & Release)
  # 
  # Tests:
  # - ci-test-ios.yml              - iOS unit tests
  # - ci-test-macos.yml            - macOS unit tests
  # 
  # Post-Build:
  # - ci-post-build-validation.yml - Post-build validation & metrics
  # - ci-status-summary.yml        - Build status summary
  # 
  # All workflows run automatically on the same events and execute in parallel
  # for faster CI execution.
  # ============================================================================
  
  trigger-workflows:
    name: ðŸš€ CI Pipeline Orchestrator
    runs-on: ubuntu-latest
    steps:
      - name: ðŸ“‹ Workflow Status
        run: |
          echo "## ðŸš€ CI Pipeline Orchestration" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "This orchestrator workflow coordinates all CI jobs. Each job runs in its own workflow file for better maintainability." >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### âœ… Validation & Quality" >> $GITHUB_STEP_SUMMARY
          echo "- **Code Quality Check** - SwiftLint validation" >> $GITHUB_STEP_SUMMARY
          echo "- **Project Validation** - Project structure checks" >> $GITHUB_STEP_SUMMARY
          echo "- **Dependency Validation** - Swift Package Manager validation" >> $GITHUB_STEP_SUMMARY
          echo "- **Security Scan** - Secret detection" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸ“¦ Builds" >> $GITHUB_STEP_SUMMARY
          echo "- **iOS Build** - Debug & Release configurations" >> $GITHUB_STEP_SUMMARY
          echo "- **macOS Build** - Debug & Release configurations" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸ§ª Tests" >> $GITHUB_STEP_SUMMARY
          echo "- **iOS Tests** - Unit tests on multiple simulators" >> $GITHUB_STEP_SUMMARY
          echo "- **macOS Tests** - Unit tests" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### âœ… Post-Build" >> $GITHUB_STEP_SUMMARY
          echo "- **Post-Build Validation** - Code metrics & quality checks" >> $GITHUB_STEP_SUMMARY
          echo "- **Status Summary** - Final build status report" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Note:** All workflows run in parallel for faster CI execution. Check individual workflow runs for detailed results." >> $GITHUB_STEP_SUMMARY
